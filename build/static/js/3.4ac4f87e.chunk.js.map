{"version":3,"sources":["models/douyin.ts","../node_modules/dva/fetch.js","utils/api.ts","services/server.ts","../node_modules/isomorphic-fetch/fetch-npm-browserify.js","utils/getCookie.ts","services/redirectToken.ts","services/douyin.ts"],"names":["__webpack_exports__","namespace","state","_douyinAnalyze","reducers","changeDouyinAnalyze","_a","data","payload","__WEBPACK_IMPORTED_MODULE_0_tslib__","video","replace","effects","queryDouyin","_b","call","put","__WEBPACK_IMPORTED_MODULE_1__services_douyin__","result","_c","sent","type","Error","err_1","module","exports","__webpack_require__","d","tokenApi","douyinApi","kuaishouApi","huoshanApi","baseUrl","__WEBPACK_IMPORTED_MODULE_1_dva_fetch__","__WEBPACK_IMPORTED_MODULE_2__utils_getCookie__","n","__WEBPACK_IMPORTED_MODULE_3__redirectToken__","_this","this","globalUrl","globalOptions","checkStatus","response","status","json","error","statusText","manageCode","code","document","cookie","request","Promise","resolve","reject","msg","url","options","token","loadingDom","getElementsByClassName","style","display","Object","getKey","link","resultUrl","race","method","setTimeout","then","catch","err","self","fetch","bind","name","arr","reg","RegExp","match","unescape","__WEBPACK_IMPORTED_MODULE_0_dva_fetch__","__WEBPACK_IMPORTED_MODULE_1__utils_api__","res","reqObj","__WEBPACK_IMPORTED_MODULE_0__server__"],"mappings":"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","file":"static/js/3.4ac4f87e.chunk.js","sourcesContent":["import {gain_douyin} from \"../services/douyin\";\r\n\r\nexport default {\r\n    namespace: 'douyin',\r\n    state: {\r\n        _douyinAnalyze: \"\"\r\n    },\r\n    reducers: {\r\n        //修改抖音解析路径\r\n        \"changeDouyinAnalyze\"(state: any, {payload: {data}}: any) {\r\n            return {\r\n                ...state,\r\n                _douyinAnalyze: data.video.video.replace(/\\s/g,\"\"),\r\n            }\r\n        },\r\n    },\r\n    effects: {\r\n        //获取抖音解析视频\r\n        * queryDouyin({payload}: any, {call, put}: any) {\r\n            try {\r\n                let result: any = yield call(gain_douyin, payload);\r\n                let {data} = result;\r\n                yield put({\r\n                    type: 'changeDouyinAnalyze',\r\n                    payload: {\r\n                        data:data\r\n                    }\r\n                })\r\n\r\n            } catch (err) {\r\n                throw new Error(err);\r\n            }\r\n\r\n        }\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/models/douyin.ts","\nmodule.exports = require('isomorphic-fetch');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/dva/fetch.js\n// module id = 338\n// module chunks = 1 2 3","/**\r\n * api接口\r\n * */\r\nconst baseUrl: string = `/api/`;//base接口\r\nexport const tokenApi:string = `${baseUrl}settoken`;//token接口\r\nexport const douyinApi: string = `${baseUrl}douyin`;//抖音接口\r\nexport const kuaishouApi: string = `${baseUrl}kuaishou`;//快手接口\r\nexport const huoshanApi: string = `${baseUrl}huoshan`;//火山接口\n\n\n// WEBPACK FOOTER //\n// ./src/utils/api.ts","/**\r\n * 进行请求\r\n * */\r\nimport * as fetch from 'dva/fetch';\r\nimport getCookie from \"./../utils/getCookie\"\r\nimport redirectToken from \"./redirectToken\"\r\n//@ts-ignore\r\nlet globalUrl: string = \"\";//请求的url\r\n//@ts-ignore\r\nlet globalOptions: any = {};//请求的参数\r\n\r\n\r\n//处理http状态码\r\nfunction checkStatus(response: any) {\r\n    if (response.status >= 200 && response.status < 300) {\r\n        return response.json();\r\n    }\r\n    const error: any = new Error(response.statusText);\r\n    error.response = response;\r\n    throw error;\r\n}\r\n\r\n\r\n//处理业务逻辑code\r\nasync function manageCode(data: any) {\r\n    // 判断是否有一些需要全局拦截的自定义code\r\n    if (data.code === 401) {\r\n        //401：token过期\r\n        document.cookie = \"token=\";\r\n        return request(globalUrl, globalOptions);\r\n    } else if (data.code !== 200) {\r\n        return new Promise((resolve, reject) => reject(data.msg));\r\n    } else {\r\n        return data;\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * Requests a URL, returning a promise.\r\n * @param  {string} url       The URL we want to request\r\n * @param  {object} [options] The options we want to pass to \"fetch\"\r\n * @return {object}           An object containing either \"data\" or \"err\"\r\n */\r\nconst request:any = async (url: string, options: any = {}) => {\r\n    let token: any = \"\";\r\n\r\n    //全局赋值\r\n    globalUrl = url;\r\n    globalOptions = options;\r\n\r\n\r\n    //显示loading\r\n    let loadingDom: any = document.getElementsByClassName(\"loading\")[0];\r\n    loadingDom.style.display = \"flex\";\r\n\r\n\r\n    //若cookie是空则去获取cookie\r\n    if (!getCookie(\"token\")) {\r\n        try {\r\n            await redirectToken();\r\n            token = getCookie(\"token\");\r\n        } catch (err) {\r\n            throw new Error(err)\r\n        }\r\n    }\r\n\r\n    //拼装url为get\r\n    let {getKey, link} = options;\r\n    let resultUrl: string = `${url}?${getKey}=${link}&token=${token}`;\r\n    return Promise.race([\r\n        fetch(resultUrl, {\r\n            method: \"GET\",\r\n        }),\r\n        new Promise(function (resolve, reject) {\r\n            setTimeout(() => reject(new Error('request timeout')), 20000)\r\n        })])\r\n        .then(checkStatus)\r\n        .then(manageCode)\r\n        .then((data) => {\r\n            loadingDom.style.display = \"none\";\r\n            return data;\r\n        })\r\n        .catch((err: any) => {\r\n                loadingDom.style.display = \"none\";\r\n                throw new Error(err)\r\n            }\r\n        );\r\n\r\n};\r\n\r\nexport default request\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/services/server.ts","// the whatwg-fetch polyfill installs the fetch() function\n// on the global object (window or self)\n//\n// Return that as the export for use in Webpack, Browserify etc.\nrequire('whatwg-fetch');\nmodule.exports = self.fetch.bind(self);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/isomorphic-fetch/fetch-npm-browserify.js\n// module id = 341\n// module chunks = 1 2 3","/**\r\n * 获取对应名称的cookie\r\n * @param name cookie的名称\r\n * @returns {null} 不存在时，返回null\r\n */\r\nvar getCookie = function (name: any) {\r\n    var arr;\r\n    var reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\r\n    if (arr = document.cookie.match(reg)){\r\n        return unescape(arr[2]);\r\n    }else{\r\n        return null;\r\n    }\r\n};\r\nexport default getCookie\n\n\n// WEBPACK FOOTER //\n// ./src/utils/getCookie.ts","import * as fetch from \"dva/fetch\";\r\nimport {tokenApi} from \"../utils/api\";\r\n\r\n/**\r\n * 获取token\r\n * */\r\n\r\nexport default function redirectToken() {\r\n    return fetch(tokenApi, {\r\n        method: \"GET\",\r\n    }).then(function (response) {\r\n        return response.json();\r\n    }).then(function (res: any) {\r\n        let {token} = res.data;\r\n        document.cookie = `token=${token}`;\r\n        return res;\r\n    }).catch(err => {\r\n        throw new Error(err)\r\n    })\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/services/redirectToken.ts","/**\r\n * 抖音解析\r\n * */\r\nimport request from \"./server\";\r\nimport {douyinApi} from \"../utils/api\";\r\n\r\n\r\nexport function gain_douyin(reqObj:any) {\r\n    return request(douyinApi,reqObj)\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/services/douyin.ts"],"sourceRoot":""}